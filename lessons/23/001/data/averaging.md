# Calculating averages

The final result that is extracted from a molecular dynamics simulation is an average.  In other words, molecular dynamics (like Monte Carlo) is a method for generating multiple samples
of a random variable so that one can take an average.  This average then provides an estimate for a physical observable, which should really be calculated by computing the ensemble average.

When we run molecular dynamics simulations there are three methods that we can use to generate the multiple samples that are used to calculate these averages:

1. We can calculate observables for each of the microstates in the trajectory and take a time average.
2. We can have multiple indistinguishable representations of the quantity of interest in each microstate we generate.  We can thus perform a spatial average over these indistinguishable entities.
3. We can run multiple trajectories in parallel and then average over these distinct replicas of the whole physical system.

The various methods that are implemented in PLUMED combine these three types of averaging in a myriad of different ways. To make the code more transparent I have thus tried to separate these various
ways of collecting data for averaging.  My hope that these separate actions can be used when implementing new methods for calculating averages and that the resulting code will provide a more transparent
explanation of the similarities and differences between all these methods.  Obviously, shortcut actions can be used to enusre that the complex inputs that are actually used to run the various methods are generated
correctly.  My hope, however, is that if folks are willing to use shortcuts when implementing new methods we can generate rich documentation that illustrates how the averages that are used in the simulations
are generated from the trajectory.  This documentation will, I hope, help users to better understand the theory behind the methods that they are employing and encourage cross-fertilisation of ideas between 
developers of different methods.

With all that in mind, allow me to explain here how the three forms of averaging described above are implemented in PLUMED.

## Unbiased time averages

Lets start with simple PLUMED input. The input below calculates and prints the time average of the distance between atom 1 and 2 to a file called average.

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_1.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_1.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_1.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<b name="averaging.md_working_1.datd1" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.datd1","averaging.md_working_1.datd1","black")'>d1</b><span style="display:none;" id="averaging.md_working_1.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <div class="tooltip" style="color:green">DISTANCE<div class="right">Calculate the distance between a pair of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between<i></i></div></div>=1,2
<span id="averaging.md_working_1.data1_short"><span id="averaging.md_working_1.datdefa1_short"><b name="averaging.md_working_1.data1" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.data1","averaging.md_working_1.data1_shortcut","black")'>a1</b><span style="display:none;" id="averaging.md_working_1.data1_shortcut">The AVERAGE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>the value of the average</td></tr></table></span>: <div class="tooltip" style="color:green">AVERAGE<div class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_1.data1");'>a shortcut</a> and it has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_1.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_v_e_r_a_g_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the quantity that is being averaged<i></i></div></div>=<b name="averaging.md_working_1.datd1">d1</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which to store data for averaging<i></i></div></div>=1
</span><span id="averaging.md_working_1.datdefa1_long" style="display:none;"><b name="averaging.md_working_1.data1" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.data1","averaging.md_working_1.data1_shortcut","black")'>a1</b>: <div class="tooltip" style="color:green">AVERAGE<div class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_1.data1");'>a shortcut</a> and uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_1.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_v_e_r_a_g_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the quantity that is being averaged<i></i></div></div>=<b name="averaging.md_working_1.datd1">d1</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which to store data for averaging<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with whihc to clear the data that is being averaged<i></i></div></div>=0
</span></span><span id="averaging.md_working_1.data1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("averaging.md_working_1.data1")'># a1: AVERAGE ARG=d1 STRIDE=1</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="averaging.md_working_1.data1_weight" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.data1_weight","averaging.md_working_1.data1_weight","black")'>a1_weight</b><span style="display:none;" id="averaging.md_working_1.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">ONES<div class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/_o_n_e_s.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">SIZE<div class="right">the number of ones that you would like to create<i></i></div></div>=1
<b name="averaging.md_working_1.data1_denom" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.data1_denom","averaging.md_working_1.data1_denom","black")'>a1_denom</b><span style="display:none;" id="averaging.md_working_1.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_1.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
<b name="averaging.md_working_1.data1_prod" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.data1_prod","averaging.md_working_1.data1_prod","black")'>a1_prod</b><span style="display:none;" id="averaging.md_working_1.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_1.datd1">d1</b>,<b name="averaging.md_working_1.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x*y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<b name="averaging.md_working_1.data1_numer" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.data1_numer","averaging.md_working_1.data1_numer","black")'>a1_numer</b><span style="display:none;" id="averaging.md_working_1.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_1.data1_prod">a1_prod</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
<b name="averaging.md_working_1.data1" onclick='showPath("averaging.md_working_1.dat","averaging.md_working_1.data1","averaging.md_working_1.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_1.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_1.data1_numer">a1_numer</b>,<b name="averaging.md_working_1.data1_denom">a1_denom</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x/y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<span style="color:blue"># --- End of included input --- </span></span><div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_1.data1">a1</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=average <div class="tooltip">STRIDE<div class="right"> the frequency with which the quantities of interest should be output<i></i></div></div>=1
</pre>
 {% endraw %} 

As the stride is set equal to one on the AVERAGE line samples are taken from every microstate that is visited in the trajectory.  If we had used the following input:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_2.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_2.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_2.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<b name="averaging.md_working_2.datd1" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.datd1","averaging.md_working_2.datd1","black")'>d1</b><span style="display:none;" id="averaging.md_working_2.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <div class="tooltip" style="color:green">DISTANCE<div class="right">Calculate the distance between a pair of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between<i></i></div></div>=1,2
<span id="averaging.md_working_2.data1_short"><span id="averaging.md_working_2.datdefa1_short"><b name="averaging.md_working_2.data1" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.data1","averaging.md_working_2.data1_shortcut","black")'>a1</b><span style="display:none;" id="averaging.md_working_2.data1_shortcut">The AVERAGE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>the value of the average</td></tr></table></span>: <div class="tooltip" style="color:green">AVERAGE<div class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_2.data1");'>a shortcut</a> and it has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_2.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_v_e_r_a_g_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the quantity that is being averaged<i></i></div></div>=<b name="averaging.md_working_2.datd1">d1</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which to store data for averaging<i></i></div></div>=10
</span><span id="averaging.md_working_2.datdefa1_long" style="display:none;"><b name="averaging.md_working_2.data1" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.data1","averaging.md_working_2.data1_shortcut","black")'>a1</b>: <div class="tooltip" style="color:green">AVERAGE<div class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_2.data1");'>a shortcut</a> and uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_2.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_v_e_r_a_g_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the quantity that is being averaged<i></i></div></div>=<b name="averaging.md_working_2.datd1">d1</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which to store data for averaging<i></i></div></div>=10  <div class="tooltip">CLEAR<div class="right"> the frequency with whihc to clear the data that is being averaged<i></i></div></div>=0
</span></span><span id="averaging.md_working_2.data1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("averaging.md_working_2.data1")'># a1: AVERAGE ARG=d1 STRIDE=10</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="averaging.md_working_2.data1_weight" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.data1_weight","averaging.md_working_2.data1_weight","black")'>a1_weight</b><span style="display:none;" id="averaging.md_working_2.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">ONES<div class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/_o_n_e_s.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">SIZE<div class="right">the number of ones that you would like to create<i></i></div></div>=1
<b name="averaging.md_working_2.data1_denom" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.data1_denom","averaging.md_working_2.data1_denom","black")'>a1_denom</b><span style="display:none;" id="averaging.md_working_2.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_2.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=10 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
<b name="averaging.md_working_2.data1_prod" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.data1_prod","averaging.md_working_2.data1_prod","black")'>a1_prod</b><span style="display:none;" id="averaging.md_working_2.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_2.datd1">d1</b>,<b name="averaging.md_working_2.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x*y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<b name="averaging.md_working_2.data1_numer" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.data1_numer","averaging.md_working_2.data1_numer","black")'>a1_numer</b><span style="display:none;" id="averaging.md_working_2.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_2.data1_prod">a1_prod</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=10 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
<b name="averaging.md_working_2.data1" onclick='showPath("averaging.md_working_2.dat","averaging.md_working_2.data1","averaging.md_working_2.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_2.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_2.data1_numer">a1_numer</b>,<b name="averaging.md_working_2.data1_denom">a1_denom</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x/y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<span style="color:blue"># --- End of included input --- </span></span><div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_2.data1">a1</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=average <div class="tooltip">STRIDE<div class="right"> the frequency with which the quantities of interest should be output<i></i></div></div>=1
</pre>
 {% endraw %} 

We would only accumulate averages on every 10th step.  We are still printing a1 on every step, however.  We would thus find that the values of a1 that are printed out on steps
10,11,12,13,14,15,16,17,18 and 19 were all the same.  No additional samples were added on these steps so the average is unchanged.

The input for the AVERAGE action is the same as it was before we merged all the new code I have been working on.  This action is now a shortcut, however.  The full input for the first of the two 
inputs above is:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_3.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_3.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_3.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<b name="averaging.md_working_3.datd1" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.datd1","averaging.md_working_3.datd1","black")'>d1</b><span style="display:none;" id="averaging.md_working_3.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <div class="tooltip" style="color:green">DISTANCE<div class="right">Calculate the distance between a pair of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between<i></i></div></div>=1,2
<span id="averaging.md_working_3.datdefa1_weight_short"><b name="averaging.md_working_3.data1_weight" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1_weight","averaging.md_working_3.data1_weight","black")'>a1_weight</b><span style="display:none;" id="averaging.md_working_3.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_3.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=1
</span><span id="averaging.md_working_3.datdefa1_weight_long" style="display:none;"><b name="averaging.md_working_3.data1_weight" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1_weight","averaging.md_working_3.data1_weight","black")'>a1_weight</b>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_3.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=1  <div class="tooltip">NROWS<div class="right"> the number of rows in your input matrix<i></i></div></div>=0 <div class="tooltip">NCOLS<div class="right"> the number of columns in your matrix<i></i></div></div>=0
</span><b name="averaging.md_working_3.data1_prod" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1_prod","averaging.md_working_3.data1_prod","black")'>a1_prod</b><span style="display:none;" id="averaging.md_working_3.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_3.datd1">d1</b>,<b name="averaging.md_working_3.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x*y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<span id="averaging.md_working_3.datdefa1_denom_short"><b name="averaging.md_working_3.data1_denom" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1_denom","averaging.md_working_3.data1_denom","black")'>a1_denom</b><span style="display:none;" id="averaging.md_working_3.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_3.datdefa1_denom");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_3.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1
</span><span id="averaging.md_working_3.datdefa1_denom_long" style="display:none;"><b name="averaging.md_working_3.data1_denom" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1_denom","averaging.md_working_3.data1_denom","black")'>a1_denom</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_3.datdefa1_denom");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_3.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span><span id="averaging.md_working_3.datdefa1_numer_short"><b name="averaging.md_working_3.data1_numer" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1_numer","averaging.md_working_3.data1_numer","black")'>a1_numer</b><span style="display:none;" id="averaging.md_working_3.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_3.datdefa1_numer");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_3.data1_prod">a1_prod</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1
</span><span id="averaging.md_working_3.datdefa1_numer_long" style="display:none;"><b name="averaging.md_working_3.data1_numer" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1_numer","averaging.md_working_3.data1_numer","black")'>a1_numer</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_3.datdefa1_numer");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_3.data1_prod">a1_prod</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span><b name="averaging.md_working_3.data1" onclick='showPath("averaging.md_working_3.dat","averaging.md_working_3.data1","averaging.md_working_3.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_3.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_3.data1_numer">a1_numer</b>,<b name="averaging.md_working_3.data1_denom">a1_denom</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x/y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_3.data1">a1</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=average <div class="tooltip">STRIDE<div class="right"> the frequency with which the quantities of interest should be output<i></i></div></div>=1
</pre>
 {% endraw %} 

Notice that the non-standard action that is used here is the one called ACCUMULATE.  This action simply adds together the instantaneous values that are passed to it.  You can use this action to 
do a sum over a time series.  The rest of the averaging operation is done with CUSTOM actions.  You can also hopefully see how the input above can easily be modified so that you can calculate 
an average from a biased simulation.  In that case you simply need to modify the input for the a1_weight command in a way that accounts for the reweighting that must be done on the biased simulation.

Notice that it is also easier to explain how block averages are computed with this input.  When describing an input like this one:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_4.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_4.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_4.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<b name="averaging.md_working_4.datd1" onclick='showPath("averaging.md_working_4.dat","averaging.md_working_4.datd1","averaging.md_working_4.datd1","black")'>d1</b><span style="display:none;" id="averaging.md_working_4.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <div class="tooltip" style="color:green">DISTANCE<div class="right">Calculate the distance between a pair of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between<i></i></div></div>=1,2
<span id="averaging.md_working_4.datdefa1_weight_short"><b name="averaging.md_working_4.data1_weight" onclick='showPath("averaging.md_working_4.dat","averaging.md_working_4.data1_weight","averaging.md_working_4.data1_weight","black")'>a1_weight</b><span style="display:none;" id="averaging.md_working_4.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_4.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=1
</span><span id="averaging.md_working_4.datdefa1_weight_long" style="display:none;"><b name="averaging.md_working_4.data1_weight" onclick='showPath("averaging.md_working_4.dat","averaging.md_working_4.data1_weight","averaging.md_working_4.data1_weight","black")'>a1_weight</b>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_4.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=1  <div class="tooltip">NROWS<div class="right"> the number of rows in your input matrix<i></i></div></div>=0 <div class="tooltip">NCOLS<div class="right"> the number of columns in your matrix<i></i></div></div>=0
</span><b name="averaging.md_working_4.data1_prod" onclick='showPath("averaging.md_working_4.dat","averaging.md_working_4.data1_prod","averaging.md_working_4.data1_prod","black")'>a1_prod</b><span style="display:none;" id="averaging.md_working_4.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_4.datd1">d1</b>,<b name="averaging.md_working_4.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x*y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<b name="averaging.md_working_4.data1_denom" onclick='showPath("averaging.md_working_4.dat","averaging.md_working_4.data1_denom","averaging.md_working_4.data1_denom","black")'>a1_denom</b><span style="display:none;" id="averaging.md_working_4.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_4.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=100
<b name="averaging.md_working_4.data1_numer" onclick='showPath("averaging.md_working_4.dat","averaging.md_working_4.data1_numer","averaging.md_working_4.data1_numer","black")'>a1_numer</b><span style="display:none;" id="averaging.md_working_4.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_4.data1_prod">a1_prod</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=100
<b name="averaging.md_working_4.data1" onclick='showPath("averaging.md_working_4.dat","averaging.md_working_4.data1","averaging.md_working_4.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_4.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_4.data1_numer">a1_numer</b>,<b name="averaging.md_working_4.data1_denom">a1_denom</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x/y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_4.data1">a1</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=average <div class="tooltip">STRIDE<div class="right"> the frequency with which the quantities of interest should be output<i></i></div></div>=1
</pre>
 {% endraw %} 

You simply state that the CLEAR=100 keywords ensure that a1_denom and a1_numer are set equal to zero on every hundreth step. 

Lastly, note that, because we are using shortcuts, we can show users what is done for special cases.  To see what I mean consider the following input:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_5.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_5.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_5.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<b name="averaging.md_working_5.datt1" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.datt1","averaging.md_working_5.datt1","black")'>t1</b><span style="display:none;" id="averaging.md_working_5.datt1">The TORSION action with label <b>t1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1</td><td width="5%"><font color="black">scalar</font></td><td>the TORSION involving these atoms</td></tr></table></span>: <div class="tooltip" style="color:green">TORSION<div class="right">Calculate a torsional angle. <a href="https://www.plumed.org/doc-master/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle<i></i></div></div>=1,2,3,4
<span id="averaging.md_working_5.data1_short"><span id="averaging.md_working_5.datdefa1_short"><b name="averaging.md_working_5.data1" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1","averaging.md_working_5.data1_shortcut","black")'>a1</b><span style="display:none;" id="averaging.md_working_5.data1_shortcut">The AVERAGE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>the value of the average</td></tr></table></span>: <div class="tooltip" style="color:green">AVERAGE<div class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_5.data1");'>a shortcut</a> and it has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_5.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_v_e_r_a_g_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the quantity that is being averaged<i></i></div></div>=<b name="averaging.md_working_5.datt1">t1</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which to store data for averaging<i></i></div></div>=1
</span><span id="averaging.md_working_5.datdefa1_long" style="display:none;"><b name="averaging.md_working_5.data1" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1","averaging.md_working_5.data1_shortcut","black")'>a1</b>: <div class="tooltip" style="color:green">AVERAGE<div class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_5.data1");'>a shortcut</a> and uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_5.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_v_e_r_a_g_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the quantity that is being averaged<i></i></div></div>=<b name="averaging.md_working_5.datt1">t1</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which to store data for averaging<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with whihc to clear the data that is being averaged<i></i></div></div>=0
</span></span><span id="averaging.md_working_5.data1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("averaging.md_working_5.data1")'># a1: AVERAGE ARG=t1 STRIDE=1</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="averaging.md_working_5.data1_weight" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1_weight","averaging.md_working_5.data1_weight","black")'>a1_weight</b><span style="display:none;" id="averaging.md_working_5.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">ONES<div class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/_o_n_e_s.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">SIZE<div class="right">the number of ones that you would like to create<i></i></div></div>=1
<b name="averaging.md_working_5.data1_denom" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1_denom","averaging.md_working_5.data1_denom","black")'>a1_denom</b><span style="display:none;" id="averaging.md_working_5.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_5.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
<b name="averaging.md_working_5.data1_sin" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1_sin","averaging.md_working_5.data1_sin","black")'>a1_sin</b><span style="display:none;" id="averaging.md_working_5.data1_sin">The CUSTOM action with label <b>a1_sin</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_sin</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_5.datt1">t1</b>,<b name="averaging.md_working_5.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=y*sin((x--pi)/((pi--pi)/(pi+pi <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<b name="averaging.md_working_5.data1_cos" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1_cos","averaging.md_working_5.data1_cos","black")'>a1_cos</b><span style="display:none;" id="averaging.md_working_5.data1_cos">The CUSTOM action with label <b>a1_cos</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_cos</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_5.datt1">t1</b>,<b name="averaging.md_working_5.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=y*cos((x--pi)/((pi--pi)/(pi+pi <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<b name="averaging.md_working_5.data1_sinsum" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1_sinsum","averaging.md_working_5.data1_sinsum","black")'>a1_sinsum</b><span style="display:none;" id="averaging.md_working_5.data1_sinsum">The ACCUMULATE action with label <b>a1_sinsum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_sinsum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_5.data1_sin">a1_sin</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
<b name="averaging.md_working_5.data1_cossum" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1_cossum","averaging.md_working_5.data1_cossum","black")'>a1_cossum</b><span style="display:none;" id="averaging.md_working_5.data1_cossum">The ACCUMULATE action with label <b>a1_cossum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_cossum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_5.data1_cos">a1_cos</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
<b name="averaging.md_working_5.data1" onclick='showPath("averaging.md_working_5.dat","averaging.md_working_5.data1","averaging.md_working_5.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_5.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_5.data1_sinsum">a1_sinsum</b>,<b name="averaging.md_working_5.data1_cossum">a1_cossum</b>,<b name="averaging.md_working_5.data1_denom">a1_denom</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=-pi+((pi--pi)/(pi+pi))*atan2(x/z,y/z <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=-pi,pi
<span style="color:blue"># --- End of included input --- </span></span><div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_5.data1">a1</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=average <div class="tooltip">STRIDE<div class="right"> the frequency with which the quantities of interest should be output<i></i></div></div>=1
</pre>
 {% endraw %} 

When this is expanded you have the following:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_6.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_6.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_6.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<b name="averaging.md_working_6.datt1" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.datt1","averaging.md_working_6.datt1","black")'>t1</b><span style="display:none;" id="averaging.md_working_6.datt1">The TORSION action with label <b>t1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1</td><td width="5%"><font color="black">scalar</font></td><td>the TORSION involving these atoms</td></tr></table></span>: <div class="tooltip" style="color:green">TORSION<div class="right">Calculate a torsional angle. <a href="https://www.plumed.org/doc-master/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle<i></i></div></div>=1,2,3,4
<span id="averaging.md_working_6.datdefa1_weight_short"><b name="averaging.md_working_6.data1_weight" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.data1_weight","averaging.md_working_6.data1_weight","black")'>a1_weight</b><span style="display:none;" id="averaging.md_working_6.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=1
</span><span id="averaging.md_working_6.datdefa1_weight_long" style="display:none;"><b name="averaging.md_working_6.data1_weight" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.data1_weight","averaging.md_working_6.data1_weight","black")'>a1_weight</b>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=1  <div class="tooltip">NROWS<div class="right"> the number of rows in your input matrix<i></i></div></div>=0 <div class="tooltip">NCOLS<div class="right"> the number of columns in your matrix<i></i></div></div>=0
</span><span id="averaging.md_working_6.datdefa1_denom_short"><b name="averaging.md_working_6.data1_denom" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.data1_denom","averaging.md_working_6.data1_denom","black")'>a1_denom</b><span style="display:none;" id="averaging.md_working_6.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdefa1_denom");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_6.data1_weight">a1_weight</b> 
</span><span id="averaging.md_working_6.datdefa1_denom_long" style="display:none;"><b name="averaging.md_working_6.data1_denom" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.data1_denom","averaging.md_working_6.data1_denom","black")'>a1_denom</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdefa1_denom");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_6.data1_weight">a1_weight</b>  <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1 <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span><b name="averaging.md_working_6.data1_sin" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.data1_sin","averaging.md_working_6.data1_sin","black")'>a1_sin</b><span style="display:none;" id="averaging.md_working_6.data1_sin">The CUSTOM action with label <b>a1_sin</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_sin</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_6.datt1">t1</b>,<b name="averaging.md_working_6.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=y*sin((x+pi)/1 <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<b name="averaging.md_working_6.data1_cos" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.data1_cos","averaging.md_working_6.data1_cos","black")'>a1_cos</b><span style="display:none;" id="averaging.md_working_6.data1_cos">The CUSTOM action with label <b>a1_cos</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_cos</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_6.datt1">t1</b>,<b name="averaging.md_working_6.data1_weight">a1_weight</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=y*cos((x+pi)/1 <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<span id="averaging.md_working_6.datdeft1_sinsum_short"><b name="averaging.md_working_6.datt1_sinsum" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.datt1_sinsum","averaging.md_working_6.datt1_sinsum","black")'>t1_sinsum</b><span style="display:none;" id="averaging.md_working_6.datt1_sinsum">The ACCUMULATE action with label <b>t1_sinsum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1_sinsum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdeft1_sinsum");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_6.data1_sin">a1_sin</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1
</span><span id="averaging.md_working_6.datdeft1_sinsum_long" style="display:none;"><b name="averaging.md_working_6.datt1_sinsum" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.datt1_sinsum","averaging.md_working_6.datt1_sinsum","black")'>t1_sinsum</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdeft1_sinsum");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_6.data1_sin">a1_sin</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span><span id="averaging.md_working_6.datdeft1_cossum_short"><b name="averaging.md_working_6.datt1_cossum" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.datt1_cossum","averaging.md_working_6.datt1_cossum","black")'>t1_cossum</b><span style="display:none;" id="averaging.md_working_6.datt1_cossum">The ACCUMULATE action with label <b>t1_cossum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1_cossum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdeft1_cossum");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_6.data1_cos">a1_cos</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1
</span><span id="averaging.md_working_6.datdeft1_cossum_long" style="display:none;"><b name="averaging.md_working_6.datt1_cossum" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.datt1_cossum","averaging.md_working_6.datt1_cossum","black")'>t1_cossum</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_6.datdeft1_cossum");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_6.data1_cos">a1_cos</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span><b name="averaging.md_working_6.data1" onclick='showPath("averaging.md_working_6.dat","averaging.md_working_6.data1","averaging.md_working_6.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_6.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_6.datt1_sinsum">t1_sinsum</b>,<b name="averaging.md_working_6.datt1_cossum">t1_cossum</b>,<b name="averaging.md_working_6.data1_denom">a1_denom</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=-pi+1*atan2(x/z,y/z <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=-pi,pi
<div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_6.data1">a1</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=average <div class="tooltip">STRIDE<div class="right"> the frequency with which the quantities of interest should be output<i></i></div></div>=1
</pre>
 {% endraw %} 

Readers of the manual can thus see how the average is calculated in a way that takes the periodicity of the variable into account without having to look inside the PLUMED source code.

## Spatial averages

Suppose that you have an input file that calculates the coordination numbers of 100 atoms like the one shown below:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_7.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_7.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_7.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<span style="color:blue" class="comment"># c1: COORDINATIONNUMBER SPECIES=1-100 SWITCH={RATIONAL R_0=1}</span>
<span style="color:blue" class="comment"># a1: ACCUMULATE ARG=c1 STRIDE=1</span>
</pre>
 {% endraw %} 

Should `a1`, the value that is output by the ACCUMULATE action here be a scalar or a vector?  In other words, should PLUMED assume that the user wants to add all 100 numbers calculated by the 
COORDINATIONNUMBER command all together when ACCUMULATE is called or should it instead assume that the user wants to accumulate individual averages for each of the 100 coordination numbers?

To me the answer to this question is obvious.  The ACCUMULATE action should output a vector.  In other words, the first element of the vector `a1` should be the sum of all the values the coordination
number of atom 1 took, the second element should be the sum of the vlaues the coordination number of atom 2 took and so on.  If the user had wanted us to convert the vector computed by the 
COORINDATIONNUMBER action to a scalar they would have told us they were doing this by using an input like this:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_8.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_8.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_8.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<span id="averaging.md_working_8.datc1_short"><b name="averaging.md_working_8.datc1" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.datc1","averaging.md_working_8.datc1_shortcut","blue")'>c1</b><span style="display:none;" id="averaging.md_working_8.datc1_shortcut">The COORDINATIONNUMBER action with label <b>c1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1</td><td width="5%"><font color="blue">vector</font></td><td>the coordination numbers of the specified atoms</td></tr></table></span>: <div class="tooltip" style="color:green">COORDINATIONNUMBER<div class="right">Calculate the coordination numbers of atoms so that you can then calculate functions of the distribution of This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_8.datc1");'>a shortcut</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_o_r_d_i_n_a_t_i_o_n_n_u_m_b_e_r.html">More details</a><i></i></div></div> <div class="tooltip">SPECIES<div class="right">this keyword is used for colvars such as coordination number<i></i></div></div>=1-100 <div class="tooltip">SWITCH<div class="right">the switching function that it used in the construction of the contact matrix<i></i></div></div>={RATIONAL R_0=1}
</span><span id="averaging.md_working_8.datc1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("averaging.md_working_8.datc1")'># c1: COORDINATIONNUMBER SPECIES=1-100 SWITCH={RATIONAL R_0=1}</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="averaging.md_working_8.datc1_grp" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.datc1_grp","averaging.md_working_8.datc1_grp","violet")'>c1_grp</b><span style="display:none;" id="averaging.md_working_8.datc1_grp">The GROUP action with label <b>c1_grp</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_grp</td><td width="5%"><font color="violet">atoms</font></td><td>indices of atoms specified in GROUP</td></tr></table></span>: <div class="tooltip" style="color:green">GROUP<div class="right">Define a group of atoms so that a particular list of atoms can be referenced with a single label in definitions of CVs or virtual atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/_g_r_o_u_p.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the numerical indexes for the set of atoms in the group<i></i></div></div>=1-100 
<b name="averaging.md_working_8.datc1_mat" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.datc1_mat","averaging.md_working_8.datc1_mat","red")'>c1_mat</b><span style="display:none;" id="averaging.md_working_8.datc1_mat">The CONTACT_MATRIX action with label <b>c1_mat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_mat</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the weights for the bonds between each pair of atoms</td></tr></table></span>: <div class="tooltip" style="color:green">CONTACT_MATRIX<div class="right">Adjacency matrix in which two atoms are adjacent if they are within a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_t_a_c_t__m_a_t_r_i_x.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">GROUP<div class="right">specifies the list of atoms that should be assumed indistinguishable<i></i></div></div>=1-100 <div class="tooltip">SWITCH<div class="right">specify the switching function to use between two sets of indistinguishable atoms<i></i></div></div>={RATIONAL R_0=1} 
<b name="averaging.md_working_8.datc1_ones" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.datc1_ones","averaging.md_working_8.datc1_ones","blue")'>c1_ones</b><span style="display:none;" id="averaging.md_working_8.datc1_ones">The CONSTANT action with label <b>c1_ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_ones</td><td width="5%"><font color="blue">vector</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">ONES<div class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/_o_n_e_s.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">SIZE<div class="right">the number of ones that you would like to create<i></i></div></div>=100
<b name="averaging.md_working_8.datc1" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.datc1","averaging.md_working_8.datc1","blue")'>c1</b><span style="display:none;" id="averaging.md_working_8.datc1">The MATRIX_VECTOR_PRODUCT action with label <b>c1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1</td><td width="5%"><font color="blue">vector</font></td><td>the vector that is obtained by taking the product between the matrix and the vector that were input</td></tr></table></span>: <div class="tooltip" style="color:green">MATRIX_VECTOR_PRODUCT<div class="right">Calculate the product of the matrix and the vector <a href="https://www.plumed.org/doc-master/user-doc/html/_m_a_t_r_i_x__v_e_c_t_o_r__p_r_o_d_u_c_t.html" style="color:green">More details</a><i></i></div></div>  <div class="tooltip">ARG<div class="right">the label for the matrix and the vector/scalar that are being multiplied<i></i></div></div>=<b name="averaging.md_working_8.datc1_mat">c1_mat</b>,<b name="averaging.md_working_8.datc1_ones">c1_ones</b>
<b name="averaging.md_working_8.datc1_caverage" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.datc1_caverage","averaging.md_working_8.datc1_caverage","black")'>c1_caverage</b><span style="display:none;" id="averaging.md_working_8.datc1_caverage">The MEAN action with label <b>c1_caverage</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_caverage</td><td width="5%"><font color="black">scalar</font></td><td>the mean of all the elements in the input vector</td></tr></table></span>: <div class="tooltip" style="color:green">MEAN<div class="right">Calculate the arithmetic mean of the elements in a vector <a href="https://www.plumed.org/doc-master/user-doc/html/_m_e_a_n.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_8.datc1">c1</b> <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<span style="color:blue"># --- End of included input --- </span></span><b name="averaging.md_working_8.datc1_mean" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.datc1_mean","averaging.md_working_8.datc1_mean","black")'>c1_mean</b><span style="display:none;" id="averaging.md_working_8.datc1_mean">The MEAN action with label <b>c1_mean</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_mean</td><td width="5%"><font color="black">scalar</font></td><td>the mean of all the elements in the input vector</td></tr></table></span>: <div class="tooltip" style="color:green">MEAN<div class="right">Calculate the arithmetic mean of the elements in a vector <a href="https://www.plumed.org/doc-master/user-doc/html/_m_e_a_n.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_8.datc1">c1</b> <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<span id="averaging.md_working_8.datdefa1_short"><b name="averaging.md_working_8.data1" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.data1","averaging.md_working_8.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_8.data1">The ACCUMULATE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_8.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_8.datc1_mean">c1_mean</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1
</span><span id="averaging.md_working_8.datdefa1_long" style="display:none;"><b name="averaging.md_working_8.data1" onclick='showPath("averaging.md_working_8.dat","averaging.md_working_8.data1","averaging.md_working_8.data1","black")'>a1</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_8.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_8.datc1_mean">c1_mean</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span></pre>
 {% endraw %} 

I think this keeps things transparent for users. I wouldn't even add shortcuts around for this sort of functionality. I think that the flexibility provided here for folks doing a mixture of time and spatial 
averaging makes things pretty straightforward and transparent.

## Averages over replicas

The example input file below shows how you can gather all the data from all replicas in one place using the GATHER_REPLICAS command:

{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_9.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_9.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_9.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<span style="color:blue" class="comment">#SETTINGS NREPLICAS=2</span>
<b name="averaging.md_working_9.datd1" onclick='showPath("averaging.md_working_9.dat","averaging.md_working_9.datd1","averaging.md_working_9.datd1","black")'>d1</b><span style="display:none;" id="averaging.md_working_9.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <div class="tooltip" style="color:green">DISTANCE<div class="right">Calculate the distance between a pair of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between<i></i></div></div>=1,2
<span id="averaging.md_working_9.datdefr1_short"><b name="averaging.md_working_9.datr1" onclick='showPath("averaging.md_working_9.dat","averaging.md_working_9.datr1","averaging.md_working_9.datr1","black")'>r1</b><span style="display:none;" id="averaging.md_working_9.datr1">The RESTRAINT action with label <b>r1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">r1.bias</td><td width="5%"><font color="black">scalar</font></td><td>the instantaneous value of the bias potential</td></tr><tr><td width="5%">r1.force2</td><td width="5%"><font color="black">scalar</font></td><td>the instantaneous value of the squared force due to this bias potential</td></tr></table></span>: <div class="tooltip" style="color:green">RESTRAINT<div class="right">Adds harmonic and/or linear restraints on one or more variables. This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_9.datdefr1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_r_e_s_t_r_a_i_n_t.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values the harmonic restraint acts upon<i></i></div></div>=<b name="averaging.md_working_9.datd1">d1</b> <div class="tooltip">AT<div class="right">the position of the restraint<i></i></div></div>=<div class="tooltip">@replicas:<div class="right">This keyword specifies that different replicas have different values for this quantity.  See <a href="https://www.plumed.org/doc-master/user-doc/html/special-replica-syntax.html">here for more details.</a><i></i></div></div>1.0,1.2 <div class="tooltip">KAPPA<div class="right"> specifies that the restraint is harmonic and what the values of the force constants on each of the variables are<i></i></div></div>=10
</span><span id="averaging.md_working_9.datdefr1_long" style="display:none;"><b name="averaging.md_working_9.datr1" onclick='showPath("averaging.md_working_9.dat","averaging.md_working_9.datr1","averaging.md_working_9.datr1","black")'>r1</b>: <div class="tooltip" style="color:green">RESTRAINT<div class="right">Adds harmonic and/or linear restraints on one or more variables. This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_9.datdefr1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_r_e_s_t_r_a_i_n_t.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values the harmonic restraint acts upon<i></i></div></div>=<b name="averaging.md_working_9.datd1">d1</b> <div class="tooltip">AT<div class="right">the position of the restraint<i></i></div></div>=<div class="tooltip">@replicas:<div class="right">This keyword specifies that different replicas have different values for this quantity.  See <a href="https://www.plumed.org/doc-master/user-doc/html/special-replica-syntax.html">here for more details.</a><i></i></div></div>1.0,1.2 <div class="tooltip">KAPPA<div class="right"> specifies that the restraint is harmonic and what the values of the force constants on each of the variables are<i></i></div></div>=10  <div class="tooltip">SLOPE<div class="right"> specifies that the restraint is linear and what the values of the force constants on each of the variables are<i></i></div></div>=0.0
</span><b name="averaging.md_working_9.datr1g" onclick='showPath("averaging.md_working_9.dat","averaging.md_working_9.datr1g","averaging.md_working_9.datr1g","black")'>r1g</b><span style="display:none;" id="averaging.md_working_9.datr1g">The GATHER_REPLICAS action with label <b>r1g</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">r1g.rep-1</td><td width="5%"><font color="black">scalar</font></td><td>the input arguments for each of the replicas  This is the 1th of these quantities</td></tr><tr><td width="5%">r1g.rep-2</td><td width="5%"><font color="black">scalar</font></td><td>the input arguments for each of the replicas  This is the 2th of these quantities</td></tr></table></span>: <div class="tooltip" style="color:green">GATHER_REPLICAS<div class="right">Create a vector that contains the copies of the input quantities from all replicas <a href="https://www.plumed.org/doc-master/user-doc/html/_g_a_t_h_e_r__r_e_p_l_i_c_a_s.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the argument from the various replicas that you would like to gather<i></i></div></div>=<b name="averaging.md_working_9.datr1">r1.bias</b>
<div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_9.datr1g">r1g.rep-1</b>,<b name="averaging.md_working_9.datr1g">r1g.rep-2</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=colvar
</pre>
 {% endraw %} 

The GATHER_REPLICAS command creates one PLUMED value object for each replica. The $N$ values output by GATHER_REPLICA contain the values of the quantities on each of the $N$ replicas.  By using GATHER_REPLICAS you 
can meke the values that you have on other replicas accessible on all replicas.  Consequently, if you can run a four replica simulation to compute the average distance between atom 1 and atom 2 you can get the average by doing:


{% raw %}
<div style="width: 100%; float:left">
<div style="width: 90%; float:left" id="value_details_averaging.md_working_10.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><table><tr><td style="padding:1px"><a href="averaging.md_working_10.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></td></tr><tr><td style="padding:1px"><a href="averaging.md_working_10.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></td></tr></table></div></div>
<pre style="width=97%;">
<b name="averaging.md_working_10.datd1" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.datd1","averaging.md_working_10.datd1","black")'>d1</b><span style="display:none;" id="averaging.md_working_10.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <div class="tooltip" style="color:green">DISTANCE<div class="right">Calculate the distance between a pair of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between<i></i></div></div>=1,2
<b name="averaging.md_working_10.datd1g" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.datd1g","averaging.md_working_10.datd1g","black")'>d1g</b><span style="display:none;" id="averaging.md_working_10.datd1g">The GATHER_REPLICAS action with label <b>d1g</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1g.rep-1</td><td width="5%"><font color="black">scalar</font></td><td>the input arguments for each of the replicas  This is the 1th of these quantities</td></tr></table></span>: <div class="tooltip" style="color:green">GATHER_REPLICAS<div class="right">Create a vector that contains the copies of the input quantities from all replicas <a href="https://www.plumed.org/doc-master/user-doc/html/_g_a_t_h_e_r__r_e_p_l_i_c_a_s.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the argument from the various replicas that you would like to gather<i></i></div></div>=<b name="averaging.md_working_10.datd1">d1</b>
<b name="averaging.md_working_10.datd1s" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.datd1s","averaging.md_working_10.datd1s","black")'>d1s</b><span style="display:none;" id="averaging.md_working_10.datd1s">The COMBINE action with label <b>d1s</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1s</td><td width="5%"><font color="black">scalar</font></td><td>a linear compbination</td></tr></table></span>: <div class="tooltip" style="color:green">COMBINE<div class="right">Calculate a polynomial combination of a set of other variables. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_m_b_i_n_e.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_10.datd1">d1</b> <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<span id="averaging.md_working_10.datdefa1_weight_short"><b name="averaging.md_working_10.data1_weight" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.data1_weight","averaging.md_working_10.data1_weight","black")'>a1_weight</b><span style="display:none;" id="averaging.md_working_10.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_10.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=4
</span><span id="averaging.md_working_10.datdefa1_weight_long" style="display:none;"><b name="averaging.md_working_10.data1_weight" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.data1_weight","averaging.md_working_10.data1_weight","black")'>a1_weight</b>: <div class="tooltip" style="color:green">CONSTANT<div class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_10.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_o_n_s_t_a_n_t.html">More details</a><i></i></div></div> <div class="tooltip">VALUES<div class="right">the numbers that are in your constant value<i></i></div></div>=4  <div class="tooltip">NROWS<div class="right"> the number of rows in your input matrix<i></i></div></div>=0 <div class="tooltip">NCOLS<div class="right"> the number of columns in your matrix<i></i></div></div>=0
</span><span id="averaging.md_working_10.datdefa1_denom_short"><b name="averaging.md_working_10.data1_denom" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.data1_denom","averaging.md_working_10.data1_denom","black")'>a1_denom</b><span style="display:none;" id="averaging.md_working_10.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_10.datdefa1_denom");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_10.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1
</span><span id="averaging.md_working_10.datdefa1_denom_long" style="display:none;"><b name="averaging.md_working_10.data1_denom" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.data1_denom","averaging.md_working_10.data1_denom","black")'>a1_denom</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_10.datdefa1_denom");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_10.data1_weight">a1_weight</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span><span id="averaging.md_working_10.datdefa1_numer_short"><b name="averaging.md_working_10.data1_numer" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.data1_numer","averaging.md_working_10.data1_numer","black")'>a1_numer</b><span style="display:none;" id="averaging.md_working_10.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_10.datdefa1_numer");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_10.datd1s">d1s</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1
</span><span id="averaging.md_working_10.datdefa1_numer_long" style="display:none;"><b name="averaging.md_working_10.data1_numer" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.data1_numer","averaging.md_working_10.data1_numer","black")'>a1_numer</b>: <div class="tooltip" style="color:green">ACCUMULATE<div class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("averaging.md_working_10.datdefa1_numer");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/_a_c_c_u_m_u_l_a_t_e.html">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the label of the argument that is being added to on each timestep<i></i></div></div>=<b name="averaging.md_working_10.datd1s">d1s</b> <div class="tooltip">STRIDE<div class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></div></div>=1  <div class="tooltip">CLEAR<div class="right"> the frequency with which to clear all the accumulated data<i></i></div></div>=0
</span><b name="averaging.md_working_10.data1" onclick='showPath("averaging.md_working_10.dat","averaging.md_working_10.data1","averaging.md_working_10.data1","black")'>a1</b><span style="display:none;" id="averaging.md_working_10.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <div class="tooltip" style="color:green">CUSTOM<div class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/_c_u_s_t_o_m.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the values input to this function<i></i></div></div>=<b name="averaging.md_working_10.data1_numer">a1_numer</b>,<b name="averaging.md_working_10.data1_denom">a1_denom</b> <div class="tooltip">FUNC<div class="right">the function you wish to evaluate<i></i></div></div>=x/y <div class="tooltip">PERIODIC<div class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></div></div>=NO
<div class="tooltip" style="color:green">PRINT<div class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/_p_r_i_n_t.html" style="color:green">More details</a><i></i></div></div> <div class="tooltip">ARG<div class="right">the labels of the values that you would like to print to the file<i></i></div></div>=<b name="averaging.md_working_10.data1">a1</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities<i></i></div></div>=average <div class="tooltip">STRIDE<div class="right"> the frequency with which the quantities of interest should be output<i></i></div></div>=1
</pre>
 {% endraw %} 

Flexibility is again offered to users here by separating the act of gathering data from replicas and adding it all together in the input file.  Also notice that if the quantity input to GATHER_REPLICAS is a vector/matrix or grid
then the output actions will be vectors matrices or grids.  In short, the syntax here agsin offers users a great deal of flexibility by separating out these three ways of collecting samples for averaging.  This flexibility hopefully also
helps users to understand how the averages that they are computing are being constructed.
